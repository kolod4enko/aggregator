# Booking

### Навигация
* [Развертывание проекта](#развертывание-проекта)
* [Сборка и прод режим](#сборка-и-прод-режим)
* [Дополнительные команды](#дополнительные-команды)
* [Список стендов](#список-стендов)
* [Правила](#правила)
* [Структура](#структура)
* [CLI команды](#cli-команды)

### Развертывание проекта
1. Используем пакетный менеджер [npm](https://docs.npmjs.com/)
2. Выполняем команду:
```sh
npm i
```
3. Создаем файл `.env` и прописываем конфигурации (используем пример `.env.example`)
4. Запускаем проект командой:
```sh
npm run dev
```

### Сборка и прод режим
```sh
npm i
npm run build
npm run prod
```

### Дополнительные команды
- Дэбаг режим:
```sh
npm run debug
```
- Форматирование кода:
```sh
npm run format
```
- Проверка и автоматическое исправление ошибок:
```sh
npm run lint
```

### Список стендов
#### Стенды
- [dev](http://reai-booking-front-stage.fc.lan)
- [prod](/)

#### Swagger
- [dev](http://reai-booking-api-stage.fc.lan/swagger)
- [prod](/)

### Правила
- Для typescript файлов используется [eslint](https://gitlab.futurecomes.net/reai/booking_mvp/api/-/blob/main/.eslintrc.js), в IDE обязательно должен быть включен *eslint*
- Для единообразия кода используем [prettier](https://gitlab.futurecomes.net/reai/booking_mvp/api/-/blob/main/.prettierrc), так же не забываем включаеть автоматическую правку в IDE
- Наименование веток "номер-задачи_короткое-название-задачи". Пример: `RAI-796_news`
- Текст коммита вида: "[номер задачи] Описание выполненой работы". Пример: `[RAI-796] Обновление Readme`
- При создании merge request используются Pipelines. В pipeline выполняется npm install, eslint, build ts. Необходимо убедится что pipeline выполнился и ошибок нет
- Интерфейсы и DTO описываем в файлах с припиской interfaces и dto в директории модуля. Пример: `news.dto.ts`
- Использовать тип `any` только в крайнем случае!!!
- Все DTO и RO должны быть описаны для Swagger
- Любые добавления и изменения правил нужно согласовывать с руководителем проекта

### Структура
```
├── deploy - настройка CI/CD

├── src
    |── constants - Глобальные константы проекта
    |── helpers - Глобальные помощники для работы с проектом
    |── modules - Все модули проекта
        |── commands - CLI команды
        |── database - Работа с базами данных
        |── news - Новости
        |── queue - Взаимодействие и обработка базы парсинга
    |── app.module.ts - Главный модуль для подключение всего остального
    |── main.ts - Точка старта приложения
```

### CLI команды
> Перед выполнением команд не забудь выполнить build проекта
> Весь путь команд логируется и промежуточные данные присылаются в телеграм чат

#### 1. Сохранение отелей из базы парсинга
 - Собираются данные Booking и Rostourism из базы парсинга,
после чего они модифицируются данными сервиса DaData
 - Начинается проход по обновленным данным и проверка на схожесть
по двум параметрам, это название и адрес отеля. Проверка названия
происходит так, находится минимальное количество символов в том
или другом название и оно сравнивается с количеством одинаковых слов
в названиях. Проверка адреса идет по геоданным, которые мы получили
из данных DaData. При схожести по обоим параметрам идет перелинковка
записей Booking и Rostourism
 - Все данные записываютс в базу проекта.
```sh
node cli parser-data-processing
```

#### 2. Модификация новостей
Так как парсинг происходит с разных площадок дата побликации новостей
храниться в разном формате. Данная команда преобразует все даты к одному
виду относительно площадки

```sh
node cli modify-news
```

